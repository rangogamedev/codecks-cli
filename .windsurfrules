# Windsurf Rules — codecks-cli

Read `AGENTS.md` in the repository root for full project instructions, architecture, and API pitfalls.
Use `PROJECT_INDEX.md` for a fast file-level map before editing.

## Essential Rules

- **Python command**: Always use `py` (never `python` or `python3`). Requires 3.10+.
- **Zero runtime dependencies**: stdlib only. Dev tools (`ruff`, `mypy`, `pytest-cov`) are optional extras.
- **Test**: `pwsh -File scripts/run-tests.ps1` (673 tests, no API calls)
- **Lint**: `py -m ruff check .`
- **Format**: `py -m ruff format --check .`
- **Type check**: `py -m mypy codecks_cli/api.py codecks_cli/cards.py codecks_cli/client.py codecks_cli/commands.py codecks_cli/formatters/ codecks_cli/models.py codecks_cli/exceptions.py codecks_cli/_utils.py codecks_cli/types.py codecks_cli/planning.py codecks_cli/setup_wizard.py codecks_cli/lanes.py codecks_cli/tags.py`
- **Contracts**: CLI JSON errors include `schema_version` (`1.0`). MCP response mode is controlled by `CODECKS_MCP_RESPONSE_MODE` (`legacy` or `envelope`).
- **Pagination**: `cards` supports `--limit` and `--offset` and returns `total_count`/`has_more` metadata in JSON.
- **Docker**: `./docker/build.sh` to build, then `./docker/test.sh`, `./docker/quality.sh`, `./docker/cli.sh <cmd>`, `./docker/claude.sh` (Claude Code in container). Security-hardened (no-new-privileges, cap_drop ALL, non-root). See `AGENTS.md` for full Docker docs.

## Critical API Pitfalls

- Response fields are snake_case, query fields are camelCase. Use `_get_field()` for safe lookups.
- **Doc cards** cannot have priority, effort, or status set (API returns 400).
- **Paid-only features** (do NOT use): Due dates (`dueAt`), Dependencies, Time tracking, Runs/Capacity, Guardians, Beast Cards.
- Never set `dueAt` on cards.
- Card title = first line of `content` field.
- Tags: set `masterTags` (not `tags`). Owner: `assigneeId` in `cards/update`.
- `parentCardId` in queries causes HTTP 500 — use `parentCard` relation instead.
- Tags in card body text (`#tag`) create deprecated user-style tags — use `masterTags` dispatch field.

## Commit Style

- Short present tense: "Add X", "Fix Y"
- Never commit `.env`, `.gdd_tokens.json`, `.gdd_cache.md`
